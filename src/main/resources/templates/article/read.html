<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="article-status" th:content="${article != null}">
    <meta name="user-status" th:content="${#authentication.getPrincipal() != 'anonymousUser'}">
    <meta name="info-status" th:if="${user != null && (user.role != 'ROLE_ADMIN')}"
          th:content="${!(user.nickname == null || user.name == null || user.contactCompany.code == null || user.contact == null || user.addressPostal == null || user.addressPrimary == null || user.addressSecondary == null)}">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <th:block th:insert="~{fragments/fragments.html :: headCdns}"></th:block>

    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/article/read.css">

    <script defer src="/js/article/read.js"></script>
</head>
<body>

<th:block th:if="${article != null}">
    <th:block th:replace="~{fragments/fragments.html :: header}"></th:block>
</th:block>

<main id="main" class="content-container-wrapper" th:if="${article != null}">
    <div class="content-container">
        <h1 th:text="${board.text}"></h1>
        <table id="articleTable" th:data-id="${article.id}" th:data-code="${board.code}">
            <thead>
            <tr>
                <th>Ï†úÎ™©</th>
                <td class="w-100" colspan="3" th:text="${article.title}"></td>
            </tr>
            <tr>
                <th>ÏûëÏÑ±Ïûê</th>
                <td class="w-50" th:text="${article.user.nickname}"></td>
                <th>Ï°∞ÌöåÏàò</th>
                <td class="w-50" th:text="${article.view}"></td>
            </tr>
            <tr>
                <th>ÏûëÏÑ± ÏùºÏãú</th>
                <td class="w-50" th:text="${article.writtenAt}"></td>
                <th th:if="${article.modifiedAt != null}">ÏàòÏ†ï ÏùºÏãú</th>
                <td class="w-50" th:if="${article.modifiedAt != null}" th:text="${article.modifiedAt}"></td>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td colspan="4" th:utext="${article.content}"></td>
            </tr>
            </tbody>
            <tbody>
            <tr>
                <th>Ï≤®Î∂Ä ÌååÏùº</th>
                <td class="file-empty" colspan="3" th:if="${fileList == null || fileList.size() == 0}">Ï≤®Î∂Ä ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§.</td>
                <td colspan="3" th:if="${fileList != null && fileList.size() > 0}">
                    <ul class="file-list">
                        <li class="item" th:each="file : ${fileList}">
                            <a class="link" th:href="@{/article/file (id=${file.id})}">
                                <img src="/images/article/read.file.icon.png" alt="" class="icon">
                                <p th:text="${file.name}"></p>
                            </a>
                            <p>(
                                <th:block
                                        th:text="${T(java.lang.Math).floor(file.size) / 1024.00 * 100 / 100}"></th:block>
                                KB)
                            </p>
                        </li>
                    </ul>
                </td>
            </tr>
            </tbody>
            <tfoot>
            <tr>
                <td colspan="4">
                    <div class="bottom-button-container">
                        <!-- #request.getParameter('a') : Ï£ºÏÜåÏ∞ΩÏóêÏÑú aÎùºÎäî ÏÜçÏÑ±Ïùò Í∞íÏùÑ Í∞ÄÏ†∏Ïò¥ -->
                        <a href="#" class="common-btn"
                           th:href="@{/board/list (code=${board.code}, page=${page})}"
                           th:if="${criterion == null || keyword == null}">Î™©Î°ù</a>
                        <a href="#" class="common-btn"
                           th:href="@{/board/list (code=${board.code}, page=${page}, criterion = ${criterion}, keyword = ${keyword})}"
                           th:if="${criterion != null && keyword != null}">Î™©Î°ù</a>
                        <span class="flex-grow-1"></span>
                        <a class="common-btn" rel="modify" sec:authorize="isAuthenticated()"
                           th:if="${(#authentication.principal.userDto.username == article.user.username)}"
                           th:href="@{/article/modify(index=${article.indexInBoard}, code=${board.code})}">ÏàòÏ†ï</a>
                        <button class="common-btn" id="deleteBtn" sec:authorize="isAuthenticated()"
                                th:if="${(#authentication.principal.userDto.username == article.user.username) || user.role == 'ROLE_ADMIN'}">
                            ÏÇ≠Ï†ú
                        </button>
                    </div>
                </td>
            </tr>
            </tfoot>
        </table>
        <form id="commentForm" th:if="${board.code != 'notice'}"
              th:with="commentRegex = ${T(com.coremap.demo.regexes.CommentRegex)}">
            <p class="comment-count">ÎåìÍ∏Ä (<span th:text="${commentList.size() + subCommentList.size()}"></span>)</p>
            <span class="horizontal gap-1">
                <textarea name="content" maxlength="1000" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî."
                              class="common-input flex-grow-1"
                          th:data-regex="${commentRegex.CONTENT.expression}"></textarea>
                <button type="submit" class="common-btn">ÎåìÍ∏Ä Ïì∞Í∏∞</button>
            </span>
        </form>
        <table class="comment-table" id="commentTable">
            <thead class="loading">
            <tr>
                <td>ÎåìÍ∏ÄÏùÑ Î∂àÎü¨Ïò§Í≥† ÏûàÏäµÎãàÎã§...</td>
            </tr>
            </thead>
            <thead class="error">
            <tr>
                <td>ÎåìÍ∏ÄÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌïòÏòÄÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú Î∂àÎü¨Ïò§Í∏∞Î•º ÌÅ¥Î¶≠Ìï¥ Ï£ºÏÑ∏Ïöî.</td>
            </tr>
            </thead>
            <tbody>
            <tr th:each="comment : ${commentList}">
                <td>
                    <div class="comment" th:data-id="${comment.id}">
                        <th:block th:if="${#authentication.getPrincipal() != 'anonymousUser'}"
                                  th:each="commentLike : ${commentLikeList}">
                            <th:block
                                    th:if="${comment.id == commentLike.comment.id && #authentication.principal.userDto.username == commentLike.user.username}"
                                    th:with="isLike=${commentLike.isLike}">
                                <input type="hidden" class="is-like" th:value="${isLike}">
                            </th:block>
                        </th:block>
                        <div class="head">
                            <span class="nickname" th:text="${comment.user.nickname}"></span>
                            <span class="written-at" th:text="${comment.writtenAt}"></span>
                            <span class="modified" th:if="${comment.modifiedAt != null}">(ÏàòÏ†ïÎê®)</span>
                            <span th:if="${article.user.username == comment.user.username}">- ÏûëÏÑ±Ïûê</span>
                            <span class="flex-grow-1"></span>
                            <th:block
                                    th:if="${#authentication.getPrincipal() != 'anonymousUser' && (#authentication.principal.userDto.username == comment.user.username || #authentication.principal.userDto.username == article.user.username || user.role == 'ROLE_ADMIN')}">
                                <span class="pointer modify">ÏàòÏ†ï</span>
                                <span class="pointer delete">ÏÇ≠Ï†ú</span>
                            </th:block>
                            <span class="pointer modify-cancel">ÏàòÏ†ï Ï∑®ÏÜå</span>
                        </div>
                        <div class="body">
                            <span class="content" th:text="${comment.content}"></span>
                            <form id="modifyForm" class="modify-form"
                                  th:with="commentRegex = ${T(com.coremap.demo.regexes.CommentRegex)}">
                                <textarea name="content" maxlength="1000" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî."
                                          class="common-input"
                                          th:data-regex="${commentRegex.CONTENT.expression}"></textarea>
                                <input type="submit" value="ÎåìÍ∏Ä ÏàòÏ†ï" class="common-btn modify-comment-btn">
                            </form>
                        </div>
                        <div class="foot" th:each="commentLikeCount : ${commentLikeCountList}"
                             th:if="${comment.id == commentLikeCount.commentId}">
                            <span class="vote vote-up">
                                <img alt="üëç" class="icon" src="/images/comment/vote.up.png">
                                <span class="value" th:text="${commentLikeCount.likeCount}"></span>
                                </span>
                            <span class="vote vote-down">
                                <img alt="üëé" class="icon" src="/images/comment/vote.down.png">
                                <span class="value" th:text="${commentLikeCount.dislikeCount}"></span>
                            </span>
                            <span class="flex-grow-1"></span>
                            <p class="pointer reply">ÎãµÍ∏Ä Îã¨Í∏∞</p>
                            <p class="pointer reply-cancel">ÎãµÍ∏Ä Îã¨Í∏∞ Ï∑®ÏÜå</p>
                        </div>
                        <form id="replyForm" class="reply-form"
                              th:with="commentRegex = ${T(com.coremap.demo.regexes.CommentRegex)}">
                            <label class="label">
                                <textarea class="common-input" maxlength="1000" name="content"
                                          placeholder="ÎãµÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî."
                                          th:data-regex="${commentRegex.CONTENT.expression}"></textarea>
                            </label>
                            <input class="common-btn" type="submit" value="ÎãµÍ∏Ä Îã¨Í∏∞">
                        </form>
                    </div>
                    <th:block th:each="subComment : ${subCommentList}" th:if="${comment.id == subComment.comment.id}">
                        <div class="comment sub" th:data-id="${subComment.id}">
                            <th:block th:if="${#authentication.getPrincipal() != 'anonymousUser'}"
                                      th:each="subCommentLike : ${subCommentLikeList}">
                                <th:block
                                        th:if="${subComment.id == subCommentLike.subComment.id && #authentication.principal.userDto.username == subCommentLike.user.username}"
                                        th:with="isLike=${subCommentLike.isLike}">
                                    <input type="hidden" class="is-like" th:value="${isLike}">
                                </th:block>
                            </th:block>
                            <div class="head">
                                <span class="nickname" th:text="${subComment.user.nickname}"></span>
                                <span class="written-at" th:text="${subComment.writtenAt}"></span>
                                <span class="modified" th:if="${subComment.modifiedAt != null}">(ÏàòÏ†ïÎê®)</span>
                                <span th:if="${article.user.username == subComment.user.username}">- ÏûëÏÑ±Ïûê</span>
                                <span class="flew-grow-1"></span>
                                <th:block
                                        th:if="${#authentication.getPrincipal() != 'anonymousUser' && (#authentication.principal.userDto.username == subComment.user.username || #authentication.principal.userDto.username == article.user.username || user.role == 'ROLE_ADMIN')}">
                                    <span class="flex-grow-1"></span>
                                    <span class="pointer modify">ÏàòÏ†ï</span>
                                    <span class="pointer delete">ÏÇ≠Ï†ú</span>
                                </th:block>
                                <span class="pointer modify-cancel">ÏàòÏ†ï Ï∑®ÏÜå</span>
                            </div>
                            <div class="body">
                                <span class="content" th:text="${subComment.content}"></span>
                                <form id="subCommentModifyForm" class="modify-form sub-comment-modify-form"
                                      th:with="commentRegex = ${T(com.coremap.demo.regexes.CommentRegex)}">
                                <textarea name="content" maxlength="1000" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî."
                                          class="common-input"
                                          th:data-regex="${commentRegex.CONTENT.expression}"></textarea>
                                    <input type="submit" value="ÎåìÍ∏Ä ÏàòÏ†ï" class="common-btn modify-comment-btn">
                                </form>
                            </div>
                            <div class="foot" th:each="subCommentLikeCount : ${subCommentLikeCountList}"
                                 th:if="${subComment.id == subCommentLikeCount.subCommentId}">
                                <span class="vote vote-up">
                                    <img alt="üëç" class="icon" src="/images/comment/vote.up.png">
                                    <span class="value" th:text="${subCommentLikeCount.likeCount}"></span>
                                </span>
                                <span class="vote vote-down">
                                    <img alt="üëé" class="icon" src="/images/comment/vote.down.png">
                                    <span class="value" th:text="${subCommentLikeCount.dislikeCount}"></span>
                                </span>
                            </div>
                        </div>
                    </th:block>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</main>

<th:block th:if="${article != null}">
    <th:block th:replace="~{fragments/fragments.html :: footer}"></th:block>
</th:block>

</body>
</html>